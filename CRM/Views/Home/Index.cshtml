@model CRM.Models.General.Month
@{
    ViewData["Title"] = "Home Page";
}

<div class="tasks-container">
    <div class="tasks-calendar">
        <table class="calendar">
            <thead>
                <tr>
                    <td>Pon</td>
                    <td>Wt</td>
                    <td>Śr</td>
                    <td>Czw</td>
                    <td>Pt</td>
                    <td>Sob</td>
                    <td>Nd</td>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Days.Length; i++)
                {
                    @if(Model.Days[i].CurrentDate.DayOfWeek == DayOfWeek.Monday)
                    { 
                        @Html.Raw("<tr>"); 
                    }
                    <td>
                        <div @(Model.MonthNumber != Model.Days[i].CurrentDate.Month ? "class=different-month" : "")>
                            <p>@Model.Days[i].CurrentDate.Day</p>
                            <div class="todoitems">
                                @for(int j = 0; j < Model.Days[i].ToDoItems?.Count; j++)
                                {
                                    var item = Model.Days[i].ToDoItems[j];
                                    <div id="@(i)_@j" class="todoitems-item" onmouseover="displayTodoitemDetails(this)" onmouseout="hideTodoitemDetails(this)">
                                        <p class="todoitems-item-time">
                                            @(item.StartTime.ToString("HH:mm") + " - " + item.EndTime.ToString("HH:mm"))
                                        </p>
                                        <p class="todoitems-item-text">
                                            @item.Text
                                        </p>
                                        @if (Model.MonthNumber == Model.Days[i].CurrentDate.Month)
                                        {
                                        <div class="todoitems-item-details"></div>
                                            <div class="todoitems-item-details-header">
                                                <span class="todoitems-item-details-time">@(item.StartTime.ToString("HH:mm") + " - " + item.EndTime.ToString("HH:mm"))</span>
                                                <div class="c100 p33 small">
                                                    <span>33%</span>
                                                    <div class="slice">
                                                        <div class="bar"></div>
                                                        <div class="fill"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </td>
                    @if (Model.Days[i].CurrentDate.DayOfWeek == DayOfWeek.Sunday)
                    {
                        @Html.Raw("</tr>");
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="tasks-controls">
        <button onclick="postDataUsingFetch()"></button>
    </div>
</div>

@section Styles
{
    <link rel="stylesheet" href="~/css/Index.css"/>
    <link rel="stylesheet" href="~/css/PercentageCircle.css"/>
}

@section Scripts 
{
    <script>
        async function postDataUsingFetch() {
            fetch("/Home", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                }
            })
            .then(async function (response) {
                if (response.ok) {
                    const data = await response.text();
                    console.log(data);
                } else {
                    console.error("Failed to post data.");
                }
            })
            .catch(function (error) {
                console.error("Error:", error);
            });
        }
        function displayTodoitemDetails(item) {
            const rect = item.getBoundingClientRect();
            const details = item.querySelector(".todoitems-item-details");
            if(details == undefined) { return; }

            details.style.left = (rect.left + item.offsetWidth + 2) + 'px';
            details.style.top = rect.top + 'px';
            details.classList.add("show");
        }
        function hideTodoitemDetails(item) {
            const details = item.querySelector(".todoitems-item-details");
            if (details == undefined) { return; }

            details.classList.remove("show");
        }
    </script>
}
